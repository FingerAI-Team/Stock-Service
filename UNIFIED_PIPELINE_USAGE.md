# 통합 파이프라인 사용법

## 개요
`main_unified.py`는 기존의 데이터 저장(`store_convlog_api.py`)과 분석(`main.py`) 기능을 하나의 통합된 파이프라인으로 처리합니다.

## 아키텍처
- **`src/pipe.py`**: `UnifiedPipeline` 클래스가 정의된 핵심 모듈
- **`main_unified.py`**: 통합 파이프라인을 실행하는 메인 스크립트

## 주요 기능
1. **데이터 수집**: API를 통한 실시간 데이터 수집
2. **데이터 처리 및 저장**: 수집된 데이터를 데이터베이스에 저장
3. **데이터 분석**: 저장된 데이터에 대한 분석 수행

## 실행 방법

### 1. 한 번만 실행 (일회성)
```bash
python main_unified.py --once
```

### 2. 스케줄링 실행 (자동 반복)
```bash
python main_unified.py
```

## 파라미터 옵션

| 파라미터 | 기본값 | 설명 |
|---------|--------|------|
| `--config_path` | `./config/` | 설정 파일 경로 |
| `--data_path` | `./data/` | 데이터 파일 경로 |
| `--file_name` | `conv_log-0705-0902.xlsx` | 파일명 (code-test 모드용) |
| `--process` | `daily` (--once), `scheduled` (스케줄링) | 실행 모드 |
| `--task_name` | `cls` | 작업 이름 |
| `--query` | `None` | 쿼리 |

## 실행 모드

### 1. `daily` 모드 (--once 사용 시)
- API를 통해 오늘 날짜 기준 데이터를 수집
- 수집된 데이터를 데이터베이스에 저장
- 저장된 데이터에 대한 분석 수행

### 2. `scheduled` 모드 (스케줄링 사용 시)
- 매 시간마다 자동으로 데이터 수집 및 분석 수행
- 스케줄: 매 정시 5분에 통합 실행 (데이터 수집 + 분석)

### 3. `code-test` 모드
- 기존 파일에서 데이터를 로드
- 파일 데이터를 데이터베이스에 저장
- 저장된 데이터에 대한 분석 수행

## 실행 예시

### 일회성 실행 (오늘 날짜 API 데이터)
```bash
python main_unified.py --once
```

### 파일 기반 실행 (특별한 경우)
```bash
python main_unified.py --once --process code-test --file_name my_data.xlsx
```

### 스케줄링 실행
```bash
python main_unified.py
```

## 로그 파일
- `main_unified.log`: 전체 실행 로그
- 콘솔 출력: 실시간 진행 상황

## 기존 파일과의 차이점

### 기존 방식
1. `store_convlog_api.py` 실행 → 데이터 저장
2. `main.py` 실행 → 데이터 분석

### 통합 방식
1. `main_unified.py` 실행 → 데이터 수집 + 저장 + 분석 (한 번에)

## 장점
- **단순화**: 하나의 명령어로 전체 프로세스 실행
- **자동화**: 데이터 수집부터 분석까지 자동 연결
- **통합 실행**: 매 정시 5분에 데이터 수집과 분석을 한번에 처리
- **안정성**: 각 단계별 오류 처리 및 로깅
- **효율성**: 중복 작업 제거 및 최적화된 흐름

## 주의사항
- 스케줄링 모드에서는 `Ctrl+C`로 중단 가능
- 데이터베이스 연결은 자동으로 관리됨
- 각 단계별 상세한 로그가 기록됨
